
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map Project</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.css' rel='stylesheet' />
</head>
<body>

<h1>Weather Map</h1>
    <div class="column-lg-6">
        <pre id='coordinates' class='coordinates'></pre>
                <div class="card">
                    <div class="container">
                        <div class="currentSA">
                            <h1>53/42</h1>
                            <img>
                            <h5>Clouds:</h5>
                            <h5>Humidity:</h5>
                            <h5>Wind:</h5>
                            <h5>Pressure:</h5>
    </div>
            </div>
            </div>
        </div>
        <div class="column">
            <div class="card">
                <div class="container">
                    <div class="currentSA">
                        <h1>53/42</h1>
                        <img src="">
                        <h5>Clouds:</h5>
                        <h5>Humidity:</h5>
                        <h5>Wind:</h5>
                        <h5>Pressure:</h5>
                    </div>
                </div>
            </div>
        </div>
</div>
<div id="map"></div>


<script
        src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous">
</script>

<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.1/mapbox-gl.js'></script>

<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js'></script>

<script src="js/mapbox-geocoder-utils.js"></script>

<script src="js/keys.js"></script>
<script>
    "use strict";

    var darkSkyUrl = "https://api.darksky.net/forecast/";
    var darkSkyAPIKey = darkskyKey;
    var corsUrl = "https://cors-anywhere.herokuapp.com/";

    var lat = 29.4241;
    var lng = -98.4936;

    var lang = '?lang=eo';

    var seconds = 1556720525;

    var dateObject = new Date(seconds * 1000);
    console.log(dateObject.toString());


    var icons = {
        "clear-day" : "imgs/icons/clear-da.svg",
        "clear-night" : "imgs/icons/clear-night.svg",
        "rain" : "imgs/icons/rain.svg",
        "snow" : "imgs/icons/snow.svg",
        "sleet" : "imgs/icons/sleet.svg",
        "wind" : "imgs/icons/wind.svg",
        "fog" : "imgs/icons/fog.svg",
        "cloudy" : "imgs/icons/cloudy.svg",
        "partly-cloudy-day" : "imgs/icons/cloudy-day.svg",
        "partly-cloudy-night" : "imgs/icons/cloudy-night.svg"
    };

    function toHtml(posts) {

        var html = '';
        var i;


        for (i = 0; i <= 2; i++) {
            html += '<div class="currentSA">';
            html += '<h4>' + posts.daily.data[i].temperatureHigh + "/";
            html += posts.daily.data[i].temperatureLow + '<img src="' + icons[posts.daily.data[i].icon] + '"></h4>';
            // html += '<img src="' + icons[posts.daily.data[i].icon] + '">';
            html += '<h6>Clouds: ' + posts.daily.data[i].cloudCover + '</h6>';
            html += '<h6>Humidity: ' + posts.daily.data[i].humidity + '</h6>';
            html += '<h6>Wind: ' + posts.daily.data[i].windGust + '</h6>';
            html += '<h6>Pressure: ' + posts.daily.data[i].pressure + '</h6>';
            html += '</div>';
            // html += '<br>';
        }

        return html;
    }

    $.get(corsUrl + darkSkyUrl + darkSkyAPIKey + "/" + lat + "," + lng + "/" + lang
        // daily: {
        //     data: {
        //         temperatureHigh: "",
        //         temperatureLow: "",
        //         cloudCover: "",
        //         humidity: "",
        //         windGust: "",
        //         pressure: ""
        //     }
        // }

    ).done(function(data) {
        console.log(data);
        $('.currentSA').html(toHtml(data));
    });





    mapboxgl.accessToken = mapboxKey;

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v9',
        zoom: 4,
        center: [-98.4916, 29.4252]
    });

    var marker = new mapboxgl.Marker()
        .setLngLat([-98.4916, 29.4260])
        .addTo(map);

    var coordinates = document.getElementById('coordinates');

    map.addControl(new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxKey
        })
    );

    var marker = new mapboxgl.Marker({
        draggable: true,
        icon: "#1034A6"
    })
        .setLngLat([-98.4916, 29.4252])
        .addTo(map);

    function onDragEnd() {
        var lngLat = marker.getLngLat();

        $.get(corsUrl + darkSkyUrl + darkSkyAPIKey + "/" + lngLat.lat + "," + lngLat.lng + "/" + lang, {
            daily: {
                data: {
                    temperatureHigh: "",
                    temperatureLow: "",
                    cloudCover: "",
                    humidity: "",
                    windGust: "",
                    pressure: ""
                }
            }

        }).done(function(data) {
            console.log(data);
            $('.currentSA').html(toHtml(data));
        });
    }

    marker.on('dragend', onDragEnd);
</script>

</body>
</html>
